
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>TrÃ¬nh Dá»‹ch Tiáº¿ng ÃŠ-Ä‘Ãª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@google/generative-ai"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <style>
    @font-face {
      font-family: 'EdeFont';
      src: url('font-ede.ttf');
    }
    body {
      font-family: 'EdeFont', sans-serif;
    }
    .ai-output {
      background-color: #fef9c3;
      padding: 1rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 p-6 font-sans">

  <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-indigo-700 mb-4">ğŸŒ Dá»‹ch Viá»‡t â†” ÃŠ-Ä‘Ãª + Gemini AI + OCR + PhÃ¡t Ã¢m</h1>

    <div class="mb-3">
      <label class="font-semibold">Nháº­p vÄƒn báº£n:</label>
      <div class="flex items-center gap-2">
        <input id="inputText" class="w-full p-2 border rounded text-black" placeholder="VÃ­ dá»¥: TÃ´i muá»‘n há»c tiáº¿ng ÃŠ-Ä‘Ãª" oninput="showSuggestions()">
        <button onclick="speakInput()">ğŸ”Š</button>
      </div>
      <div id="suggestions" class="mt-1 flex flex-wrap gap-2 text-sm"></div>
    </div>

    <div class="flex gap-2 flex-wrap mb-4">
      <button onclick="translateBidirectional()" class="bg-blue-600 text-white px-4 py-2 rounded">â†” Dá»‹ch</button>
      <button onclick="callGemini('vÃ­ dá»¥')" class="bg-purple-600 text-white px-4 py-2 rounded">ğŸ’¡ VÃ­ dá»¥</button>
      <button onclick="callGemini('Ä‘oáº¡n vÄƒn')" class="bg-pink-600 text-white px-4 py-2 rounded">âœï¸ Äoáº¡n vÄƒn</button>
      <button onclick="callGemini('giáº£i thÃ­ch')" class="bg-orange-600 text-white px-4 py-2 rounded">â“ Giáº£i thÃ­ch</button>
      <button onclick="toggleAIResult()" class="bg-gray-600 text-white px-4 py-2 rounded">ğŸ‘ï¸ áº¨n/Hiá»‡n AI</button>
      <button onclick="clearHistory()" class="bg-gray-400 text-white px-4 py-2 rounded">ğŸ—‘ï¸ XÃ³a lá»‹ch sá»­</button>
    </div>

    <div>
      <label class="font-semibold">Káº¿t quáº£:</label>
      <textarea id="outputText" class="w-full p-2 border rounded bg-gray-50 h-32 text-black" readonly></textarea>
      <div id="aiResult" class="ai-output hidden text-black"></div>
    </div>

    <div class="mt-6">
      <label class="font-semibold">ğŸ“· Dá»‹ch tá»« áº£nh:</label>
      <input type="file" id="imageInput" accept="image/*" multiple onchange="handleImageUpload()" class="mb-2">
      <div id="ocrResults" class="space-y-4"></div>
    </div>

    <div class="mt-6">
      <h3 class="font-semibold">ğŸ•˜ Lá»‹ch sá»­:</h3>
      <ul id="historyList" class="list-disc pl-5 text-sm text-gray-700"></ul>
    </div>
  </div>

<script>
const dict = {
  "tÃ´i": "KÃ¡o", "báº¡n": "Ih", "chÃ o": "Kkuh", "tÃªn": "AnÃ n", "tiáº¿ng": "Klei",
  "tiáº¿ng Ãª-Ä‘Ãª": "Klei ÃŠÄ‘Ãª", "há»c": "HriÃ m", "Äƒn": "HuÃ ", "náº¥u": "KnÃ ",
  "chÆ¡i": "HlÃ p", "nÆ°á»›c": "Ãƒa ]Ã£", "quyá»ƒn sÃ¡ch": "HdruÃ¤m hrÃ ", "dáº¡y": "MtÃ¤",
  "muá»‘n": "}iÃ ng", "Ä‘i": "Nao", "nhÃ ": "Sang", "xe": "Ãƒdeh", "viá»‡c": "BruÃ "
};
const reverseDict = Object.fromEntries(Object.entries(dict).map(([k,v]) => [v.toLowerCase(), k]));

function translateBidirectional() {
  const input = document.getElementById("inputText").value.toLowerCase();
  const result = input.split(/\s+/).map(w => dict[w] || reverseDict[w] || `[${w}]`).join(" ");
  document.getElementById("outputText").value = result;
  saveHistory(input + " â†’ " + result);
}

function speakInput() {
  const msg = new SpeechSynthesisUtterance(document.getElementById("inputText").value);
  speechSynthesis.speak(msg);
}

function saveHistory(entry) {
  let history = JSON.parse(localStorage.getItem("history") || "[]");
  history.unshift(entry);
  localStorage.setItem("history", JSON.stringify(history.slice(0, 10)));
  renderHistory();
}

function clearHistory() {
  localStorage.removeItem("history");
  renderHistory();
}

function renderHistory() {
  const list = document.getElementById("historyList");
  list.innerHTML = "";
  const history = JSON.parse(localStorage.getItem("history") || "[]");
  history.forEach(h => {
    const li = document.createElement("li");
    li.textContent = h;
    li.onclick = () => document.getElementById("inputText").value = h.split("â†’")[0].trim();
    list.appendChild(li);
  });
}

function showSuggestions() {
  const input = document.getElementById("inputText").value.toLowerCase();
  const sugDiv = document.getElementById("suggestions");
  sugDiv.innerHTML = "";
  if (!input) return;
  Object.keys(dict).concat(Object.keys(reverseDict)).forEach(w => {
    if (w.startsWith(input)) {
      const btn = document.createElement("button");
      btn.textContent = w;
      btn.className = "bg-gray-200 px-2 py-1 rounded";
      btn.onclick = () => {
        document.getElementById("inputText").value = w;
        sugDiv.innerHTML = "";
      };
      sugDiv.appendChild(btn);
    }
  });
}

async function callGemini(type) {
  const input = document.getElementById("inputText").value;
  if (!input) return alert("Nháº­p ná»™i dung trÆ°á»›c!");
  const prompts = {
    "vÃ­ dá»¥": `Viáº¿t vÃ­ dá»¥ vá»›i: ${input}`,
    "Ä‘oáº¡n vÄƒn": `Viáº¿t Ä‘oáº¡n vÄƒn dá»±a trÃªn: ${input}`,
    "giáº£i thÃ­ch": `Giáº£i thÃ­ch tá»«/ngá»¯ phÃ¡p cá»§a: ${input}`
  };
  const apiKey = "AIzaSyDJ7ECoH5VagzAqaZ5QrBFS2Yx-mWbHmOg";
  const genAI = new google.generativeai.GenerativeModel({ model: "gemini-pro", apiKey });
  const result = await genAI.generateContent(prompts[type]);
  const text = await result.response.text();
  const box = document.getElementById("aiResult");
  box.textContent = "ğŸ¤– Gemini: " + text;
  box.classList.remove("hidden");
}

function toggleAIResult() {
  document.getElementById("aiResult").classList.toggle("hidden");
}

function handleImageUpload() {
  const files = document.getElementById("imageInput").files;
  const container = document.getElementById("ocrResults");
  container.innerHTML = "";
  for (const file of files) {
    const reader = new FileReader();
    reader.onload = () => {
      const img = document.createElement("img");
      img.src = reader.result;
      img.className = "max-w-xs border rounded";

      const output = document.createElement("div");
      output.textContent = "â³ Äang nháº­n diá»‡n...";
      container.appendChild(img);
      container.appendChild(output);

      Tesseract.recognize(reader.result, 'vie+eng').then(res => {
        output.textContent = "ğŸ“ OCR: " + res.data.text.trim();
      });
    };
    reader.readAsDataURL(file);
  }
}

renderHistory();
</script>
</body>
</html>
